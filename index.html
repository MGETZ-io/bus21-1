<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Routen erstellen</title>
</head>
<body>
    <h1>Routen erstellen und ausw채hlen</h1>

    <div id="route-list">
        <h2>Erstellte Routen</h2>
        <ul id="route-ul">
            <!-- Dynamisch generierte Routen werden hier eingef체gt -->
        </ul>
    </div>

    <div id="create-route">
        <h2>Neue Route erstellen</h2>
        <label for="route-name">Routenname:</label>
        <input type="text" id="route-name" placeholder="Routenname" required>
        <br>
        <label for="route-stops">Haltestellen (Komma getrennt):</label>
        <input type="text" id="route-stops" placeholder="Haltestellen" required>
        <br>
        <button id="create-button">Route erstellen</button>
    </div>

    <button id="start-ride" style="display: none;">Jetzt fahren</button>

    <script>
        // JSON-Datei, die die Routen speichert
        const routesJsonPath = 'routes.json';
        let routes = [];

        // Lade die gespeicherten Routen
        fetch(routesJsonPath)
            .then(response => response.json())
            .then(data => {
                routes = data;
                displayRoutes();
            });

        // Routen anzeigen
        function displayRoutes() {
            const routeUl = document.getElementById('route-ul');
            routeUl.innerHTML = '';

            routes.forEach((route, index) => {
                const li = document.createElement('li');
                li.textContent = `${route.name} - Haltestellen: ${route.stops.join(', ')}`;
                li.addEventListener('click', () => selectRoute(index));
                routeUl.appendChild(li);
            });
        }

        // Route ausw채hlen und "Jetzt fahren"-Button anzeigen
        function selectRoute(index) {
            const route = routes[index];
            document.getElementById('start-ride').style.display = 'inline-block';
            document.getElementById('start-ride').onclick = () => startRoute(route);
        }

        // Route erstellen
        document.getElementById('create-button').addEventListener('click', () => {
            const name = document.getElementById('route-name').value;
            const stops = document.getElementById('route-stops').value.split(',');

            const newRoute = { name, stops };
            routes.push(newRoute);
            saveRoutes();
            displayRoutes();
        });

        // Routen speichern
        function saveRoutes() {
            fetch(routesJsonPath, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(routes)
            });
        }

        // "Jetzt fahren"-Button gedr체ckt
        function startRoute(route) {
            // Route an die Handy-Seite weitergeben (hier kannst du eine API-Anfrage an die Handy-Seite stellen)
            console.log('Route starten:', route);
            fetch('https://api.github.com/repos/MGETZ-io/bus21-2/contents/currentRoute.json', {
                method: 'PUT',
                headers: {
                    'Authorization': 'Bearer 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',
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: 'Aktuelle Route gestartet',
                    content: btoa(JSON.stringify(route)) // Base64-encode die Route
                })
            });
        }
    </script>
</body>
</html>
